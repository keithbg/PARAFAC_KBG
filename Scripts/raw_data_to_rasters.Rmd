---
title: "raw data to rasters"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(raster)
```

### Import data

```{r message=FALSE, warning=FALSE}

raw <- list.files("../EEms_Raw", recursive = TRUE)

raw <- raw[str_detect(raw, "data_export/.*Processed Graph")]

data <- list()

for (i in 1:length(raw)) {
  data[[i]] <- read_tsv(paste0("../EEms_Raw/", raw[i]), skip = 3, col_names = FALSE)
  names(data)[i] <- raw[i]
}
d
```

### Fix column names

```{r}

data <- lapply(data, setNames, nm = c("wavelength", seq(600, 240, -3)))

```

### Orient matrix correctly and generate raster

```{r }

rasters <- lapply(data, function(x) raster(data.matrix(x[250:1,122:2]), xmn=240, xmx = 600, ymn = 212, ymx = 620))

```

### For the purpose of getting a rough idea of the raw data, min-max normalize

```{r}

norm <- lapply(rasters, function(x) (x-x@data@min)/(x@data@max-x@data@min))

```


### Plot/animate

```{r}

rasStack <-stack(norm)

animate(rasStack, zlim = c(0,1), pause = .05, n = 1)

```

Where I left off: This method works best in the RStudio console (using the plot window to view lots of plots). The plots from 1607_ELDC_EMP_1 onwards get squeezed into the top of the frame. Is this because the raw data was not standardized for increment? I'll move on to working with the processed data for now, but it might be worth eventually returning to this script to fix that.